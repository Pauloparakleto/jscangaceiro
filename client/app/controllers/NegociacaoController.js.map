{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacao","Negotiations","NegotiationDao","NegotiationService","NegotiationsView","MessageView","Message","DateConverter","InvalidDate","Bind","getNegotiationDao","debounce","controller","NegociacaoController","constructor","_inputDate","_inputQuantity","_inputValue","$","document","querySelector","bind","self","Object","assign","_service","_negotiations","_message","_init","adiciona","event","preventDefault","converter","date","toDate","value","negotiation","_createNegotiation","then","dao","add","text","_cleanForm","error","console","log","stack","message","clearIndex","clearList","importIndex","negotiations","period","filter","toArray","some","oldNegotiation","isEqualTo","newNegotiation","forEach","listAll","valueAsNumber","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacao, Negotiations, NegotiationDao, NegotiationService } from \"../domain/index.js\";\nimport { NegotiationsView, MessageView, Message, DateConverter, InvalidDate } from \"../ui/index.js\";\nimport { Bind, getNegotiationDao, debounce, controller } from \"../util/index.js\";\n\n@controller('#date', '#quantity', '#value')\nexport class NegociacaoController {\n  constructor(_inputDate, _inputQuantity, _inputValue) {\n    // I mention to JQuery, we will bind the $ variable to the document context\n    const $ = document.querySelector.bind(document);\n    const self = this;\n\n    Object.assign(this, { _inputDate, _inputQuantity, _inputValue })\n\n    this._service = new NegotiationService();\n    this._negotiations = new Bind(\n      new Negotiations(),\n      new NegotiationsView('#negotiations'),\n      'add', 'clearList'\n    );\n\n    this._message = new Bind(\n      new Message(),\n      new MessageView('#messageView'),\n      'text'\n    );\n\n    this._init();\n  }\n\n  @debounce()\n  adiciona(event) {\n    try {\n      // cancela a submissao do formulario\n      event.preventDefault();\n\n\n      let converter = DateConverter;\n\n      let date = converter.toDate(this._inputDate.value);\n\n      const negotiation = this._createNegotiation();\n\n      getNegotiationDao()\n        .then(dao => dao.add(negotiation))\n        .then(() =>{\n          this._negotiations.add(negotiation);\n          this._message.text = 'You made a new negotiation!';\n          this._cleanForm();\n      });\n\n    } catch (error) {\n      console.log(error.stack);\n      if (error instanceof InvalidDate){\n        this._message.text = error.message;\n      } else {\n        this._message.text = 'Something went wrong!';\n      }\n    }\n  }\n\n\n  async clearIndex() {\n    try {\n      const dao = await getNegotiationDao();\n      await dao.clearIndex();\n\n      this._negotiations.clearList();\n      this._message.text = 'Negotiation list is empty!';\n    } catch (error) {\n      console.log(error.stack);\n      this._message.text = error;\n    }\n  }\n\n  @debounce()\n  async importIndex() {\n    try {\n      const negotiations = await this._service.period();\n      negotiations.filter(\n        newNegotiation => !this._negotiations.toArray()\n          .some(oldNegotiation => oldNegotiation.isEqualTo(newNegotiation))\n      ).forEach(negotiation => this._negotiations.add(negotiation));\n\n      this._message.text = 'Negotiations imported!';\n    } catch (error) {\n      console.log(error.stack);\n      this._message.text = error;\n    }\n  }\n\n  async _init(){\n    try {\n      const dao = await getNegotiationDao();\n      const negotiations = await dao.listAll();\n      negotiations.forEach(negotiation => this._negotiations.add(negotiation));\n    } catch (error) {\n      console.log(error.stack);\n      this._message.text = error;\n    }\n  }\n\n  _createNegotiation(){\n    return new Negociacao(\n      DateConverter.toDate(this._inputDate.value),\n      this._inputQuantity.valueAsNumber,\n    );\n  }\n\n  _cleanForm() {\n    this._inputQuantity.value = 1;\n    this._inputDate.value = '';\n    this._inputValue.value = 0.0;\n    this._inputDate.focus();\n  }\n}\n"]}